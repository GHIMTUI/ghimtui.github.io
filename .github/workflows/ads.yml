- name: Process Ads File
      id: process_step
      run: |
        FILE_PATH="z-ads/ads.txt"
        
        # 1. Tách Header (giữ lại các dòng bắt đầu bằng ! hoặc [)
        grep -E "^!|^\[" "$FILE_PATH" > header.tmp || touch header.tmp
        
        # 2. Xử lý nội dung chính:
        # - Loại bỏ header cũ, xóa www., xóa khoảng trắng thừa
        # - Sắp xếp duy nhất (sort -u)
        # - Chèn dòng trống giữa các nhóm ký tự (0-9, a, b, c...)
        grep -vE "^!|^\[" "$FILE_PATH" | \
        sed -e 's/^www\.//g' -e 's/[[:space:]]*$//' | \
        grep . | sort -u | \
        awk '{
          current_char = tolower(substr($0, 1, 1));
          if (NR > 1 && current_char != last_char) {
            print ""; 
          }
          print $0;
          last_char = current_char;
        }' > sorted_body.tmp
        
        # 3. Ghi đè lại file gốc
        if cat header.tmp sorted_body.tmp > "$FILE_PATH"; then
          echo "BOT: ✔ Xử lý file ads.txt thành công!"
        else
          echo "BOT: ✘ Xử lý file ads.txt thất bại!"
          exit 1
        fi
