name: Standardize ads.txt

on:
  push:
    paths:
      - 'z-ads/ads.txt'
  workflow_dispatch:

jobs:
  format-ads:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Process ads.txt
        run: |
          FILE_PATH="z-ads/ads.txt"
          
          # Kiểm tra nếu file tồn tại
          if [ ! -f "$FILE_PATH" ]; then
            echo "File không tồn tại!"
            exit 1
          fi

          python3 -c "
import re

path = '$FILE_PATH'
with open(path, 'r') as f:
    # 1. Đọc file và loại bỏ khoảng trắng đầu/cuối mỗi dòng
    raw_lines = f.readlines()

processed_lines = []
for line in raw_lines:
    clean_line = line.strip()
    if clean_line:
        # 2. Loại bỏ tiền tố www. (ở đầu dòng hoặc sau dấu phẩy)
        clean_line = re.sub(r'^www\.', '', clean_line)
        clean_line = re.sub(r',\s*www\.', ', ', clean_line)
        processed_lines.append(clean_line)

# 3. Loại bỏ trùng lặp bằng set() và sắp xếp lại
unique_lines = sorted(list(set(processed_lines)))

# 4. Phân nhóm 0-9 và a-z kèm khoảng trống
organized = []
last_char = None

for line in unique_lines:
    # Lấy ký tự đầu tiên để định danh nhóm
    first_char = line[0].lower()
    current_group = '0-9' if first_char.isdigit() else first_char
    
    # Nếu đổi nhóm thì chèn dòng trống
    if last_char is not None and last_char != current_group:
        organized.append('')
    
    organized.append(line)
    last_char = current_group

# Ghi đè lại file ads.txt
with open(path, 'w') as f:
    f.write('\n'.join(organized) + '\n')
"

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: loại bỏ trùng lặp và sắp xếp ads.txt [bot]"
          file_pattern: 'z-ads/ads.txt'
