name: Standardize ads.txt

on:
  push:
    paths:
      - 'z-ads/ads.txt'
  workflow_dispatch:

jobs:
  format-ads:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Process ads.txt
        shell: python
        run: |
          import re
          import os

          file_path = "z-ads/ads.txt"
          
          if not os.path.exists(file_path):
              print("File không tồn tại!")
              exit(0)

          # 1. Đọc và làm sạch dữ liệu ban đầu
          with open(file_path, 'r') as f:
              raw_lines = f.readlines()

          processed_set = set()
          for line in raw_lines:
              clean = line.strip()
              if clean and not clean.startswith('#'):
                  # Loại bỏ www. ở đầu hoặc sau dấu phẩy
                  clean = re.sub(r'^www\.', '', clean)
                  clean = re.sub(r',\s*www\.', ', ', clean)
                  processed_set.add(clean)

          # 2. Sắp xếp danh sách đã loại bỏ trùng lặp
          unique_lines = sorted(list(processed_set))

          # 3. Phân nhóm và tạo khoảng trống
          organized = []
          last_group = None

          for line in unique_lines:
              first_char = line[0].lower()
              # Xác định nhóm: 0-9 hoặc a-z
              current_group = '0-9' if first_char.isdigit() else first_char
              
              if last_group is not None and last_group != current_group:
                  organized.append('') # Thêm dòng trống khi đổi nhóm
              
              organized.append(line)
              last_group = current_group

          # 4. Ghi lại vào file
          with open(file_path, 'w') as f:
              f.write('\n'.join(organized) + '\n')

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: chuẩn hóa, xóa trùng lặp ads.txt [bot]"
          file_pattern: 'z-ads/ads.txt' 
