name: Auto Sort & Categorize Ads List
on:
  push:
    paths:
      - 'z-ads/ads.txt'

permissions:
  contents: write

jobs:
  sort-and-clean:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Process and Categorize Ads
        id: process
        shell: python
        run: |
          import os

          file_path = "z-ads/ads.txt"
          with open(file_path, 'r') as f:
              lines = f.readlines()

          header = [line.strip() for line in lines if line.startswith(('!', '['))]
          # Lọc các dòng nội dung, xóa khoảng trắng và loại bỏ trùng lặp
          body = list(set([line.strip() for line in lines if line.strip() and not line.startswith(('!', '['))]))
          
          # Sắp xếp theo alphabet
          body.sort()

          # Ghi lại vào file (Header trước, sau đó là nội dung đã sắp xếp)
          with open(file_path, 'w') as f:
              for h in header:
                  f.write(h + '\n')
              if header: f.write('\n') # Thêm dòng trống sau header cho đẹp
              
              last_char = ""
              for line in body:
                  # Tùy chọn: Thêm comment phân cách khi đổi chữ cái đầu (A, B, C...)
                  current_char = line[0].upper()
                  if current_char != last_char and current_char.isalpha():
                      f.write(f"\n# --- {current_char} ---\n")
                      last_char = current_char
                  f.write(line + '\n')
          
          print(f"diff={len(lines) - (len(header) + len(body))}")

      - name: Commit and Push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto-categorize & Clean ads list"
          file_pattern: 'z-ads/ads.txt'
